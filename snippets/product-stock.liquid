{% comment %} 
  Snippet: Product Stock Display 
  - Displays current inventory quantity for the selected variant 
  - Shows visual indicator based on stock level
 
  Parameters: 
  - product: The product object (required) 
  - show_icon: Show icon before text (optional, default: false) 
  - custom_text: Custom prefix text (optional, e.g. "Limited initial release")
{% endcomment %}

{% assign variant = product.selected_or_first_available_variant %}
{% assign stock_qty = variant.inventory_quantity %}

{% if show_icon == blank %}
  {% assign show_icon = false %}
{% endif %}

{% comment %} Build stock text {% endcomment %}
{% if stock_qty %}
  {% if stock_qty <= 0 %}
    {% assign stock_status = 'out-of-stock' %}
  {% else %}
    {% assign stock_status = 'in-stock' %}
  {% endif %}
  
  {% if custom_text != blank %}
    {% assign stock_text = custom_text | append: ' (' | append: stock_qty | append: ' in stock)' %}
  {% else %}
    {% assign stock_text = stock_qty | append: ' in stock' %}
  {% endif %}
{% else %}
  {% assign stock_status = 'in-stock' %}
  {% if custom_text != blank %}
    {% assign stock_text = custom_text %}
  {% else %}
    {% assign stock_text = 'In stock' %}
  {% endif %}
{% endif %}

<!-- DEBUG: stock_status = {{ stock_status }}, stock_text = {{ stock_text }} -->

<div
  class="product-stock"
  data-inventory="{{ stock_qty }}"
  data-variant-id="{{ variant.id }}">
  <div class="product-stock__wrapper product-stock--{{ stock_status }}">
    {% if show_icon %}
      <span class="product-stock__icon">
        {% if stock_status == 'out-of-stock' %}
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <circle
              cx="8"
              cy="8"
              r="7"
              stroke="currentColor"
              stroke-width="2" />
            <path
              d="M5 8H11"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round" />
          </svg>
        {% else %}
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <circle
              cx="8"
              cy="8"
              r="7"
              stroke="currentColor"
              stroke-width="2" />
            <path
              d="M5 8L7 10L11 6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        {% endif %}
      </span>
    {% endif %}
    <span class="product-stock__text">{{ stock_text }}</span>
  </div>
</div>

<style>
  .product-stock {
    margin: 12px 0;
  }

  .product-stock__wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
    font-weight: 500;
    line-height: 20px;
    letter-spacing: 0.5px;
  }

  .product-stock__icon {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .product-stock__text {
    display: inline-block;
  }

  /* Stock Status Colors */
  .product-stock--out-of-stock {
    color: #DC2626;
    /* Red */
  }

  .product-stock--in-stock {
    color: #16A34A;
    /* Green */
  }
</style>